# E3-S3: Daily/Weekly Summary Generation

## Story
**As a** developer running AI agents across multiple projects throughout the week
**I want** to see aggregated daily and weekly summaries of what was accomplished
**So that** I can report on progress, track productivity trends, and answer "what did I work on this week?"

## Status
- **Epic**: Extended Features
- **Priority**: P1-High
- **Points**: 8
- **Sprint**: 6
- **Dependencies**: None (dev_logs table and DevLog type already exist)

## Acceptance Criteria
- [ ] AC1: A new "Summaries" tab/page in the dashboard shows daily and weekly reports
- [ ] AC2: Daily summaries aggregate all dev logs for a given date, grouped by project, showing: total session count, total duration, files changed count, commits made, tool usage breakdown
- [ ] AC3: Weekly summaries aggregate daily data across 7 days with the same per-project breakdowns plus cross-project totals
- [ ] AC4: The user can toggle between "daily" and "weekly" views and navigate between dates/weeks using prev/next controls
- [ ] AC5: Each summary card shows a project-level breakdown with the most significant activities highlighted
- [ ] AC6: The API endpoint `GET /api/summaries?period=daily&date=2026-02-11` returns structured summary data
- [ ] AC7: The API endpoint `GET /api/summaries?period=weekly&week=2026-W07` returns the weekly aggregate
- [ ] AC8: If no dev logs exist for the selected period, the view shows an empty state with a helpful message

## Technical Notes

### Summary Data Structure
```typescript
interface PeriodSummary {
  period: 'daily' | 'weekly';
  start_date: string;      // ISO date: "2026-02-11"
  end_date: string;        // ISO date: "2026-02-11" (daily) or "2026-02-17" (weekly)
  projects: ProjectSummary[];
  totals: SummaryTotals;
}

interface ProjectSummary {
  project_name: string;
  session_count: number;
  total_duration_minutes: number;
  files_changed: string[];   // Deduplicated across sessions
  commit_count: number;
  commits: string[];         // Commit messages
  tool_breakdown: Record<string, number>;  // Aggregated across sessions
  dev_logs: DevLog[];        // The raw dev log entries
}

interface SummaryTotals {
  total_sessions: number;
  total_duration_minutes: number;
  total_files_changed: number;
  total_commits: number;
  active_projects: number;
}
```

### Server-Side Aggregation
The summary is computed on-demand from the `dev_logs` table, not pre-generated. This is simpler and the data volume is small (dozens of dev logs per day at most). SQL query groups by project_name and filters by date range on `ended_at` column.

### Date Handling
- Daily: filter `ended_at` between start-of-day and end-of-day (UTC)
- Weekly: filter `ended_at` between Monday 00:00 and Sunday 23:59 (ISO week)
- Use `Date` arithmetic in TypeScript, no external date library needed

### Client Component
The `SummaryReport.vue` component lives alongside other dashboard components. It fetches data from the API when the period or date changes. The layout should follow the card-based pattern established in `ProjectOverview.vue`.

### App.vue Integration
Add a "Summaries" button/tab to the header area of `App.vue`. When clicked, show `SummaryReport.vue` in place of or alongside the main event timeline. Follow the existing pattern of conditional rendering with `v-if`.

## Tasks
- [ ] Task 1: Add `PeriodSummary`, `ProjectSummary`, and `SummaryTotals` interfaces to `apps/server/src/types.ts`
- [ ] Task 2: Create `apps/server/src/summaries.ts` with:
  - `getDailySummary(date: string): PeriodSummary` - query dev_logs for a specific date, aggregate by project
  - `getWeeklySummary(isoWeek: string): PeriodSummary` - query dev_logs for an ISO week, aggregate by project
  - Helper: `aggregateDevLogs(logs: DevLog[]): ProjectSummary[]` - group logs by project, merge tool breakdowns, deduplicate files
  - Helper: `calculateTotals(projects: ProjectSummary[]): SummaryTotals`
- [ ] Task 3: Add API routes to `apps/server/src/index.ts`:
  - `GET /api/summaries?period=daily&date=YYYY-MM-DD` -> calls `getDailySummary()`
  - `GET /api/summaries?period=weekly&week=YYYY-Www` -> calls `getWeeklySummary()`
  - Validate query params, return 400 for invalid period/date
- [ ] Task 4: Create `apps/client/src/components/SummaryReport.vue`:
  - Period toggle (daily/weekly) with prev/next date navigation
  - Project summary cards with session count, duration, files, commits, tool breakdown
  - Totals bar at the top showing cross-project aggregates
  - Empty state for no data
  - Uses `fetch()` to call `/api/summaries` endpoint
- [ ] Task 5: Add client-side types for `PeriodSummary`, `ProjectSummary`, `SummaryTotals` to `apps/client/src/types.ts`
- [ ] Task 6: Integrate `SummaryReport.vue` into `apps/client/src/App.vue`:
  - Add a "Summaries" toggle button in the header
  - Conditionally render `SummaryReport.vue` when active
  - Pass necessary props or let the component self-fetch

## Files to Create/Modify
| File | Action | Description |
|------|--------|-------------|
| `apps/server/src/summaries.ts` | Create | Summary aggregation logic with date filtering |
| `apps/server/src/types.ts` | Modify | Add `PeriodSummary`, `ProjectSummary`, `SummaryTotals` interfaces |
| `apps/server/src/index.ts` | Modify | Add `GET /api/summaries` route with period/date params |
| `apps/client/src/components/SummaryReport.vue` | Create | Summary report component with period toggle and project cards |
| `apps/client/src/types.ts` | Modify | Add client-side summary types |
| `apps/client/src/App.vue` | Modify | Add Summaries toggle button, import and render `SummaryReport.vue` |

## Testing
- [ ] Test 1: Unit test `summaries.ts` - `getDailySummary()` correctly aggregates 3 dev logs from 2 projects into a PeriodSummary with correct totals
- [ ] Test 2: Unit test `summaries.ts` - `getDailySummary()` for a date with no logs returns empty projects array and zero totals
- [ ] Test 3: Unit test `summaries.ts` - `getWeeklySummary()` correctly spans Monday-Sunday and aggregates across days
- [ ] Test 4: Unit test `summaries.ts` - `aggregateDevLogs()` correctly merges tool breakdowns (sums counts) and deduplicates file paths
- [ ] Test 5: Integration test - seed dev_logs, call `GET /api/summaries?period=daily&date=2026-02-11`, verify response structure and values
- [ ] Test 6: Integration test - `GET /api/summaries?period=invalid` returns 400

## Definition of Done
- [ ] Code compiles without errors
- [ ] All acceptance criteria met
- [ ] No TypeScript errors
- [ ] Responsive on mobile and desktop
- [ ] Dark/light theme support works
- [ ] Date navigation wraps correctly at month/year boundaries
- [ ] Empty states display correctly
- [ ] Summary data matches manually verified dev log aggregations
