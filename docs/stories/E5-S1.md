# E5-S1: Command Palette / Quick Actions

## Story
**As a** developer monitoring multiple projects and sessions
**I want** a searchable command palette accessible via Cmd+K
**So that** I can quickly navigate to projects, filter events, toggle settings, and perform common actions without leaving the keyboard

## Status
- **Epic**: Developer Experience & Productivity
- **Priority**: P1-High
- **Points**: 5
- **Sprint**: 5
- **Dependencies**: None (standalone, works with existing components)

## Acceptance Criteria
- [ ] AC1: Pressing Cmd+K (Mac) or Ctrl+K (Windows/Linux) opens a centered modal overlay with a search input auto-focused
- [ ] AC2: The palette displays a categorized list of actions: Navigate (jump to project), Filter (filter by session/source/type), Actions (clear events, toggle theme), and Settings (open theme manager)
- [ ] AC3: Typing in the search input performs fuzzy matching across all action labels, descriptions, and keywords in real-time
- [ ] AC4: Arrow keys navigate the result list, Enter executes the selected action, Escape closes the palette
- [ ] AC5: "Jump to project" actions are dynamically populated from the current projects list (fetched from `GET /api/projects`)
- [ ] AC6: "Filter by session" actions are populated from the current filter options (fetched from `GET /events/filter-options`)
- [ ] AC7: Executing a navigation action closes the palette and applies the corresponding filter or navigates to the target view
- [ ] AC8: The palette backdrop has a semi-transparent overlay and the modal uses theme CSS variables for styling
- [ ] AC9: When no results match the search query, a "No matching commands" empty state is shown

## Technical Notes

### Architecture
- New component `CommandPalette.vue` renders as a fixed overlay (z-50) similar to `ThemeManager.vue` pattern
- New composable `useCommandPalette.ts` manages open/close state, action registry, fuzzy search logic, and keyboard navigation
- The composable registers a global `keydown` listener for Cmd+K / Ctrl+K and Escape
- Fuzzy search uses a simple scoring algorithm: exact substring match scores highest, then prefix match, then character-by-character fuzzy match

### Action Registry Pattern
Each action is an object:
```typescript
interface CommandAction {
  id: string;
  label: string;           // Display name: "Jump to ClassForge"
  category: 'navigate' | 'filter' | 'action' | 'settings';
  keywords: string[];      // Extra search terms: ["project", "classforge"]
  icon: string;            // Emoji: "folder", "funnel", "gear"
  execute: () => void;     // Callback when selected
}
```

### Integration Points
- `App.vue` imports `CommandPalette.vue` and places it at the root level (alongside `ThemeManager`)
- `App.vue` imports `useCommandPalette` to register actions that need access to App-level state (filters, clearEvents, showThemeManager)
- Dynamic actions (projects, sessions) are refreshed each time the palette opens by fetching from `API_BASE_URL`

### Styling
- Overlay: `fixed inset-0 z-50 bg-black/50 backdrop-blur-sm`
- Modal: `bg-[var(--theme-bg-primary)] border border-[var(--theme-border-primary)] rounded-xl shadow-2xl max-w-lg w-full mx-auto mt-[15vh]`
- Search input: `bg-[var(--theme-bg-secondary)] border-b border-[var(--theme-border-primary)] text-[var(--theme-text-primary)]`
- Selected item: `bg-[var(--theme-primary)]/10 border-l-2 border-[var(--theme-primary)]`
- Category headers: `text-xs font-medium uppercase tracking-wide text-[var(--theme-text-tertiary)]`

## Tasks
- [ ] Task 1: Create `apps/client/src/composables/useCommandPalette.ts` with action registry, fuzzy search function, keyboard navigation state (selectedIndex ref), and global keydown listener for Cmd+K/Ctrl+K
- [ ] Task 2: Create `apps/client/src/components/CommandPalette.vue` with overlay, search input, categorized results list, and keyboard navigation (ArrowUp/ArrowDown/Enter/Escape)
- [ ] Task 3: Implement fuzzy search scoring function that ranks exact matches > prefix matches > substring matches > character fuzzy matches
- [ ] Task 4: Register static actions in `useCommandPalette.ts`: clear events, toggle theme manager, toggle filters panel
- [ ] Task 5: Implement dynamic action loading -- on palette open, fetch projects from `GET /api/projects` and filter options from `GET /events/filter-options`, generate "Jump to {project}" and "Filter by {session/source/type}" actions
- [ ] Task 6: Modify `apps/client/src/App.vue` to import and render `CommandPalette.vue`, pass action callbacks (clearEvents, showThemeManager toggle, filter updates) via the composable
- [ ] Task 7: Add a small "Cmd+K" hint badge in the App.vue header (next to existing buttons) to indicate the shortcut exists

## Files to Create/Modify
| File | Action | Description |
|------|--------|-------------|
| `apps/client/src/composables/useCommandPalette.ts` | Create | Composable: action registry, fuzzy search, keyboard state, global shortcut listener |
| `apps/client/src/components/CommandPalette.vue` | Create | Component: overlay modal with search input, categorized action list, keyboard navigation |
| `apps/client/src/App.vue` | Modify | Import CommandPalette, render at root level, register App-level actions, add Cmd+K hint badge |

## Testing
- [ ] Test 1: Pressing Cmd+K opens the palette and Escape closes it
- [ ] Test 2: Typing "clear" in search shows "Clear Events" action; pressing Enter executes it
- [ ] Test 3: Arrow keys move selection highlight through the filtered results list
- [ ] Test 4: Fuzzy search for "cf" matches "ClassForge" project action
- [ ] Test 5: With no matching query, empty state "No matching commands" is displayed
- [ ] Test 6: Dynamic project actions refresh when palette opens (mock fetch response)

## Definition of Done
- [ ] Code compiles without errors (`cd apps/client && bun run build`)
- [ ] All acceptance criteria met
- [ ] No TypeScript errors
- [ ] Responsive on mobile and desktop (palette is full-width on mobile)
- [ ] Dark/light theme support works via CSS variables
- [ ] Keyboard-only navigation works end-to-end without mouse
